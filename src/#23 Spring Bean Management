# #23 Spring Bean Management

- **Spring MVC**

    In Spring MVC (Model View Controller), Controllers are main components that receive  and respond web requests. Spring Boot and MVC use powerful annotations to easily expose classes and methods to the web.

- **The Main Controller Annotations**
    - `@Controller`: This annotation marks the class as a Spring MVC Controller. It is typically used when returning "views" (e.g. Thymeleaf or JSP templates).
    - `@RestController`: A combination of the `@Controller` and `@ResponseBody` annotations. This indicates that the class is a "RESTful" web service that directly returns HTTP response bodies such as JSON or XML. This is the most common usage in modern API implementations.
    - `@RequestMapping`: Can be used at both class and method level. It defines URL paths to map web requests to specific methods.
        - `@GetMapping`: Short for `@RequestMapping(method = RequestMethod.GET)` for HTTP GET requests.
        - `@PostMapping`: Short for HTTP POST requests.
        - `@PutMapping`: Short for HTTP PUT requests.
        - `@DeleteMapping`: Short for HTTP DELETE requests.
- **Receiving Request Parameters**
    - `@RequestParam`: Binds an HTTP request parameter (query parameter) to the method parameter. For example: `/search?q=java`.
    - `@PathVariable`: Binds a variable in the URL path to the method parameter. For example: `/users/{id}`.
    - `@RequestBody`: Binds the HTTP request body (usually JSON or XML) to the method parameter and automatically converts it to a Java object (POJO).
- **Example for: `@RestController`**

    ![image.png](attachment:fd0aae89-e607-47b4-909a-bd545611e04d:image.png)

- **Spring Bean Scopes**

    In Spring, bean scope determines how many instances (objects) the Spring IoC container will create from a bean and how long these instances will live.

    Scope is defined with the `@Scope` annotation.

- **Main Bean Scopes**
    - **Singleton**
        - **Description:** The Spring IoC container creates *only* one instance for each bean definition. All requests are directed to that single instance.
        - **Default:** This is the default scope of Spring.
        - **Example:** `DatabaseConnection` or `Service` classes are usually singletons.
        - **Usage:** `@Scope("singleton")` (or nothing).
    - **Prototype**
        - **Description:** A *new instance* of a bean is created each time it is requested from the container (e.g., when `getBean()` is called or *autowired*).
        - **Example:** Objects that store state, but require a different state on each use.
        - Usage**:** `@Scope("prototype")`
- Scope Examples

    ![image.png](attachment:8a35a67d-cd2d-4172-acb7-5d58ff057d41:image.png)

- **Scopes for Web Applications**

    These scopes are only available when using a web-based Spring `ApplicationContext` (e.g., in a Spring Boot application).

    - **Request**
        - **Description:** Creates a new bean instance for each HTTP request. The instance is destroyed after the request completes.
        - **Usage:** `@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)`
    - **Session**
        - **Description:** Creates a bean instance for each HTTP session. The same bean is used as long as the user session is active.
        - **Usage:** `@Scope(value = "session", proxyMode = ScopedProxyMode.TARGET_CLASS)`
    - **Application**
        - **Description:** Creates a bean instance for the entire application lifecycle (i.e., for the `ServletContext`). Similar to Singleton, but stored as a `ServletContext` attribute.
- **Spring Bean Lifecycle**

    The lifecycle of a Spring bean describes the stages it goes through from its instantiation by the Spring container to its destruction. Controlling this process allows us to manage the state of the bean, allocate or release resources.

    1. **Instantiation:** Spring creates a bean object by calling the class constructor.
    2. **Populate Properties:** Spring *injects* dependencies (for example, populating fields marked with `@Autowired`).
    3. **Aware Interfaces:** Spring checks for special *interfaces* such as `BeanNameAware`, `BeanFactoryAware`, `ApplicationContextAware` to make the bean aware of the container and calls the appropriate methods.
    4. **Initialization:**
        - Methods annotated with `@PostConstruct` are called.
        - If the bean implements the `InitializingBean` interface, the `afterPropertiesSet()` method is called.
        - The method specified with `init-method` (in the XML configuration) is called.
        - **Most commonly used and recommended:** `@PostConstruct`.
    5. **Ready to Use:** The bean is now ready to be used in the application.
    6. **Destruction:** When the container is closed (for example, when the application is stopped):
        - Methods annotated with `@PreDestroy` are called.
        - If the bean implements the `DisposableBean` interface, the `destroy()` method is called.
        - The method specified with `destroy-method` (in the XML configuration) is called.
        - **Most commonly used and recommended:** `@PreDestroy`.
- **Example: Spring Bean Lifecycle**

    ### `@PostConstruct` and `@PreDestroy`)

    These annotations come from the `javax.annotation` package (in Java 9+ versions, may require an additional dependency: `javax.annotation-api`).

    ![image.png](attachment:04cb4eed-deb0-464e-9730-a9e7a7c16dc3:image.png)

- **Notes:**

    For `prototype` scoped beans, Spring does not control their destruction lifecycle. Spring creates them and passes them to the client code, and the responsibility then falls on the client.